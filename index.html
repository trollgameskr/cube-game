<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="3x3 큐브 퍼즐 게임 - GitHub Pages용 웹앱">
    <title>3x3 큐브 퍼즐 게임</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <button type="button" id="focus-exit-btn" aria-label="집중 모드 종료">집중 모드 종료 (Esc)</button>
    <div class="app">
        <header class="app-header">
            <h1>3D 3x3 큐브 게임</h1>
            <p>큐브를 드래그해 회전하고, 빈 공간을 드래그해 화면을 이동하세요. 핀치나 휠로 확대/축소할 수 있습니다.</p>
        </header>

        <main class="app-main">
            <section class="cube-section" aria-labelledby="cube-title">
                <h2 id="cube-title" class="sr-only">3D 큐브</h2>
                <div class="cube-stage" id="cube-stage"></div>
                <p class="cube-hint">큐브 위를 드래그하면 회전, 빈 공간을 드래그하면 팬 이동, 터치 핀치나 마우스 휠로 줌이 가능합니다.</p>
            </section>

            <section class="control-section" aria-labelledby="control-title">
                <h2 id="control-title" class="sr-only">조작 패널</h2>

                <div class="hud">
                    <div class="hud-item">이동 수 <strong id="move-count">0</strong></div>
                    <div class="hud-item">최근 이동 <span id="move-log">-</span></div>
                </div>

                <div id="message" class="message">섞기 버튼으로 게임을 시작하세요!</div>

                <div class="actions">
                    <button type="button" id="scramble-btn" class="btn primary">섞기</button>
                    <button type="button" id="reset-btn" class="btn">리셋</button>
                    <button type="button" id="hint-btn" class="btn">힌트</button>
                    <button type="button" id="focus-btn" class="btn">집중 모드</button>
                </div>

                <div class="hotkeys">
                    <h3>단축키 안내</h3>
                    <p>U, D, L, R, F, B 키로 면 회전 • Shift+키는 반시계 방향 • Space로 최근 메시지 확인 • T로 뒷면 보기 토글 • Esc로 집중 모드 전환</p>
                    <button type="button" id="customize-keys-btn" class="btn btn-small">단축키 커스터마이징</button>
                </div>
            </section>
        </main>

        <!-- Leaderboard Section -->
        <section class="leaderboard-section" aria-labelledby="leaderboard-title">
            <h2 id="leaderboard-title">🏆 글로벌 순위</h2>
            <p class="leaderboard-description">모든 기기에서 공유되는 최고 기록들입니다!</p>
            
            <div id="leaderboard-status" class="leaderboard-status">
                순위표 불러오는 중...
            </div>
            
            <div id="leaderboard-list" class="leaderboard-list">
                <!-- Leaderboard entries will be inserted here -->
            </div>
            
            <div class="leaderboard-actions">
                <button type="button" id="refresh-leaderboard-btn" class="btn btn-small">새로고침</button>
            </div>
        </section>

        <footer class="app-footer">
            <small>정적 파일만으로 동작하므로 GitHub Pages에 바로 배포할 수 있습니다.</small>
        </footer>
    </div>

    <!-- Keyboard Customization Modal -->
    <div id="keyboard-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>단축키 커스터마이징</h2>
                <button type="button" id="close-modal-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-instruction">각 기능에 원하는 키를 할당하려면 입력 필드를 클릭하고 키를 누르세요.</p>
                
                <div class="key-mapping-item" style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem; margin-bottom: 1rem;">
                    <label style="flex: 1;">카메라 기준 회전 모드:</label>
                    <input type="checkbox" id="camera-relative-mode" style="width: auto; cursor: pointer;">
                    <span style="margin-left: 0.5rem; opacity: 0.7; font-size: 0.9rem;">
                        (켜짐: 카메라 시점 기준, 꺼짐: 고정 축 기준)
                    </span>
                </div>
                
                <div class="key-mapping-list">
                    <div class="key-mapping-item">
                        <label>위(Up) 면 회전:</label>
                        <input type="text" id="key-U" readonly placeholder="키를 누르세요">
                        <span class="key-display" data-key="U"></span>
                    </div>
                    <div class="key-mapping-item">
                        <label>아래(Down) 면 회전:</label>
                        <input type="text" id="key-D" readonly placeholder="키를 누르세요">
                        <span class="key-display" data-key="D"></span>
                    </div>
                    <div class="key-mapping-item">
                        <label>왼쪽(Left) 면 회전:</label>
                        <input type="text" id="key-L" readonly placeholder="키를 누르세요">
                        <span class="key-display" data-key="L"></span>
                    </div>
                    <div class="key-mapping-item">
                        <label>오른쪽(Right) 면 회전:</label>
                        <input type="text" id="key-R" readonly placeholder="키를 누르세요">
                        <span class="key-display" data-key="R"></span>
                    </div>
                    <div class="key-mapping-item">
                        <label>앞(Front) 면 회전:</label>
                        <input type="text" id="key-F" readonly placeholder="키를 누르세요">
                        <span class="key-display" data-key="F"></span>
                    </div>
                    <div class="key-mapping-item">
                        <label>뒤(Back) 면 회전:</label>
                        <input type="text" id="key-B" readonly placeholder="키를 누르세요">
                        <span class="key-display" data-key="B"></span>
                    </div>
                    <div class="key-mapping-item">
                        <label>뒷면 보기 토글:</label>
                        <input type="text" id="key-toggleTransparency" readonly placeholder="키를 누르세요">
                        <span class="key-display" data-key="toggleTransparency"></span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" id="reset-keys-btn" class="btn">기본값으로 초기화</button>
                    <button type="button" id="save-keys-btn" class="btn primary">저장</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Victory Modal for Nickname Input -->
    <div id="victory-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🎉 축하합니다!</h2>
                <button type="button" id="close-victory-modal-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="victory-message">큐브를 완성했습니다!</p>
                <div class="victory-stats">
                    <div class="victory-stat-item">
                        <span class="victory-stat-label">이동 횟수:</span>
                        <span class="victory-stat-value" id="victory-move-count">0</span>
                    </div>
                    <div class="victory-stat-item">
                        <span class="victory-stat-label">소요 시간:</span>
                        <span class="victory-stat-value" id="victory-time">0:00</span>
                    </div>
                </div>
                <div class="nickname-input-section">
                    <label for="nickname-input">순위표에 등록할 이름:</label>
                    <input type="text" id="nickname-input" maxlength="20" placeholder="닉네임을 입력하세요">
                    <p class="nickname-hint">이름을 입력하고 저장하면 글로벌 순위표에 기록됩니다!</p>
                </div>
                <div class="modal-actions">
                    <button type="button" id="skip-leaderboard-btn" class="btn">건너뛰기</button>
                    <button type="button" id="save-score-btn" class="btn primary">기록 저장</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration - using a demo project
        const firebaseConfig = {
            apiKey: "AIzaSyBNCTDhSV9l69OKA9ZuAX1wvcsJMtrFbOU",
            authDomain: "cube-github.firebaseapp.com",
            projectId: "cube-github",
            storageBucket: "cube-github.firebasestorage.app",
            messagingSenderId: "386970660236",
            appId: "1:386970660236:web:ef0708e03e3103cae0faa9"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make db available globally
        window.firebaseDb = db;
    </script>
    
    <script type="module" src="lib/three-global.js"></script>
    <script src="game.js" defer></script>
</body>
</html>
